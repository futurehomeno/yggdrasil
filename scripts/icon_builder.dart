import 'dart:io';

void main() {
  /// Path to the directory containing the SVG icons.
  const String inputPath = 'assets/icons';

  /// Path to the directory where the generated Dart file will be saved.
  const String outputPath = 'lib/src/icons/icons.dart';

  /// Directory object pointing to the directory containing the SVG icons.
  final Directory directory = Directory(inputPath);

  /// Buffer used to build the contents of the generated Dart file.
  final StringBuffer buffer = StringBuffer()
    ..writeln('/// Class providing names of SVG icons as static const strings.')
    ..writeln('///')
    ..writeln('/// Generated by scripts/icon_builder.dart.')
    ..writeln('class YgIcons {')
    ..writeln('  YgIcons._();')
    ..writeln('');

  // List of files in the directory.
  final List<FileSystemEntity> files = directory.listSync(recursive: false, followLinks: false);
  for (final FileSystemEntity entity in files) {
    // Only process SVG files.
    if (entity is File && entity.path.endsWith('.svg')) {
      final String fileName = entity.path.split(Platform.pathSeparator).last;
      final String iconName = fileName.split('.').first;
      final String camelCaseIconName = toCamelCase(iconName);
      buffer.writeln('  static const String $camelCaseIconName = \'$inputPath/$iconName.svg\';');
    }
  }

  // Add some space.
  buffer.writeln('');

  buffer.writeln('  static const List<String> allIconPaths = <String>[');
  for (final FileSystemEntity entity in files) {
    // Only process SVG files.
    if (entity is File && entity.path.endsWith('.svg')) {
      final String fileName = entity.path.split(Platform.pathSeparator).last;
      final String iconName = fileName.split('.').first;
      final String camelCaseIconName = toCamelCase(iconName);
      buffer.writeln('    $camelCaseIconName,');
    }
  }

  // Close the list.
  buffer.writeln('  ];');

  // Add some space.
  buffer.writeln('');

  buffer.writeln('  static const List<String> allIconNames = <String>[');
  for (final FileSystemEntity entity in files) {
    // Only process SVG files.
    if (entity is File && entity.path.endsWith('.svg')) {
      final String fileName = entity.path.split(Platform.pathSeparator).last;
      final String iconName = fileName.split('.').first;
      final String camelCaseIconName = toCamelCase(iconName);
      buffer.writeln('    \'$camelCaseIconName\',');
    }
  }

  // Close the list.
  buffer.writeln('  ];');

  // Close the class.
  buffer.writeln('}');

  // Write the output file.
  final File outputFile = File(outputPath);
  outputFile
    ..createSync(recursive: true)
    ..writeAsStringSync(buffer.toString());
}

/// Converts [text] to camelCase.
///
/// Replaces hyphens and underscores with spaces, then capitalizes the
/// first character of each word (except the first word).
/// Finally, removes the spaces to form a single word.
String toCamelCase(String text) {
  final String normalizedText = text.replaceAll('-', '_');
  return normalizedText.split('_').asMap().entries.map((MapEntry<int, String> entry) {
    if (entry.key == 0) return entry.value;
    return '${entry.value[0].toUpperCase()}${entry.value.substring(1)}';
  }).join();
}
